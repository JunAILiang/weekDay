# 9月27日发布事故复盘

## 什么问题？

9月27日晚上8点发布新版本后，**有50%的用户访问网站时出现黑屏或资源加载失败**。

问题持续了36小时，直到9月29日下午1点半才发现并修复。

**影响范围：** 约199个用户（一半的注册用户）

---

## 为什么发生？

**直接原因：** 我们有2台服务器，发布时只更新了1台，另外1台没更新。用户随机访问到哪台服务器，就看运气了。

**根本原因：**

1. **发布脚本有问题** - 脚本设计时以为会自动更新所有服务器，实际上只更新了1台
2. **发布后测试不够** - 只测试了1次就认为没问题，恰好访问到更新的那台服务器
3. **没有监控告警** - 系统出问题了，我们不知道，用户也没反馈

---

## 为什么36小时后才发现？

- 发布后测试时，恰好访问到了已更新的服务器，没发现问题
- 没有监控系统告警
- 用户没有主动反馈
- 直到华哥测试其他功能时偶然发现黑屏，才开始排查

---

## 怎么解决的？

9月29日上午发现问题后：
1. 多次测试复现问题（发现是50%概率出现）
2. 查日志，发现资源加载错误
3. 检查服务器，发现有1台没更新
4. 手动更新那台服务器，问题解决

**用时：** 从发现到解决，花了4小时

---

## 如何避免再次发生？

1. **修复发布脚本** - 确保发布时同时更新所有服务器
2. **建立发布检查清单** - 每次发布必须：
   - 检查所有服务器版本一致
   - 至少刷新测试5次以上
   - 检查浏览器控制台没有错误
3. **加强发布验证** - 发布后至少测试10次，确保没有概率性问题

