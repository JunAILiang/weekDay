# 广告转化漏斗分析报表需求

## 一、需求背景

需要分析用户从广告曝光到最终转化（支付、绑定）的完整漏斗路径，评估广告投放效果和用户转化质量。

## 二、数据来源

### ~~手动填写数据~~（已废弃）
- ~~广告曝光数~~
- ~~广告点击数~~

### 埋点事件数据

| 漏斗环节 | 事件类型 | 筛选条件 | 统计方式 |
|---------|---------|---------|---------|
| 落地页曝光数 | `app_landing_launch` | `fbclid` 不为空且不为 "unknown" | UV（按 `device_id` 去重） |
| ~~落地页按钮点击数~~ | ~~`pwa_cta_click`~~ | ~~`fbclid` 不为空且不为 "unknown"~~ | ~~UV（按 `device_id` 去重）~~（已废弃） |
| 安全弹窗同意数 | `user_landing` | `click_agree == "true"`，新用户 | UV（按 `user_id` 去重） |
| 高荷视频展示数 | `fake_call_triggered` | 新用户 | UV（按 `user_id` 去重） |
| 高荷触发付费数 | `recharge_button_clicked` | 新用户 | UV（按 `user_id` 去重） |
| 促销弹窗订单数 | `payment_continue_click` | `entry_source == "pop_promotion"`，新用户 | UV（按 `user_id` 去重） |
| 高荷页订单数 | `payment_continue_click` | `entry_source == "highly_video"`，新用户 | UV（按 `user_id` 去重） |
| 首日付费数 | `payment_success` | 新用户 | UV（按 `user_id` 去重） |
| 第三方绑定成功数 | `user_bind` | `bind_method` 有值，新用户 | UV（按 `user_id` 去重） |

**说明：**
- **落地页曝光数**：此时用户尚未注册，使用 `extra.device_id` 字段统计独立设备数
- ~~**落地页按钮点击数**：此时用户尚未注册，同样使用 `extra.device_id` 字段统计独立设备数~~（已废弃）
- **新用户定义**：后端根据 `user_id` 查询用户表，判断该用户的注册日期是否为统计当天
- **首日付费数**：统计当日所有完成付费的新用户数，不限入口来源

## 三、事件数据示例

### 3.1 落地页曝光（app_landing_launch）
```json
{
  "event": "app_landing_launch",
  "extra": "{\"fbclid\":\"IwZXh0bgNhZW0BMABhZGlkAasrjG...\",\"device_id\":\"b6eaf24f-d678-4275-a128-2427375eda3b\",\"platform\":\"FB\",\"pwa_installed\":\"false\"}"
}
```

### ~~3.2 落地页按钮点击（pwa_cta_click）~~（已废弃）
```json
{
  "event": "pwa_cta_click",
  "extra": "{\"fbclid\":\"IwZXh0bgNhZW0BMABhZGlkAassN9RZ1XxzcnRjBmFwcF9pZAo2NjI4NTY4Mzc5AAEeJkIAZlU7wOg6vQ2DsO6x8jNmY1pDWZ6rS8xkZCTlJkMYOxVIkQy8d8f0Wjk_aem_lgT72yHrQ2waYh4FPm2EPQ\",\"new_user\":\"\",\"device_id\":\"0bf2d4dd-b9af-4054-8b83-acc9ac5e7190\",\"button_name\":\"start_header\",\"platform\":\"FB\",\"pwa_installed\":\"false\"}"
}
```

### 3.3 安全弹窗同意（user_landing）
```json
{
  "event": "user_landing",
  "extra": "{\"new_user\":\"false\",\"click_agree\":\"true\",\"device_type\":\"iOS\"}"
}
```

### 3.4 高荷视频展示（fake_call_triggered）
```json
{
  "event": "fake_call_triggered",
  "extra": "{\"trigger_source\":\"other\",\"call_index\":\"1\"}"
}
```

### 3.5 高荷触发付费（recharge_button_clicked）
```json
{
  "event": "recharge_button_clicked",
  "extra": "{\"popup_type\":\"0\",\"call_index\":\"1\",\"video_id\":\"1995479211355275264\"}"
}
```

### 3.6 促销弹窗订单（payment_continue_click - pop_promotion）
```json
{
  "event": "payment_continue_click",
  "extra": "{\"country\":\"USA\",\"entry_source\":\"pop_promotion\",\"app_version\":\"web\",\"selected_method\":\"{\\\"payChannel\\\":\\\"Apple_Pay#AG\\\",\\\"title\\\":\\\"Apple Pay\\\",\\\"iconUrl\\\":\\\"https://agilecdn.livchat.me/20240523/1716451659701.png?Expires=1767254776&OSSAccessKeyId=LTAI5tNPNT6g1inCHkxgcUGz&Signature=qX05fOWEC6LFbENGkPohvomog2Y%3D&x-oss-process=image%2Fresize%2Cm_lfit%2Ch_1080%2Cw_1080%2Climit_1\\\",\\\"presentCoinRatio\\\":50,\\\"promotionPresentCoinRatio\\\":10,\\\"jumpType\\\":1,\\\"itemType\\\":1,\\\"recommendReason\\\":\\\"Recommend\\\"}\",\"user_id\":\"2000549733256527872\",\"total_amount\":\"4.99\",\"entry_pv\":\"wall\",\"user_tier\":\"guest\",\"device_type\":\"android\",\"selected_package\":\"{\\\"id\\\":\\\"715553aa-bfe4-42eb-acef-b0d471ee25f6\\\",\\\"code\\\":\\\"522407\\\",\\\"price\\\":4.99,\\\"coins\\\":1200}\",\"previous_balance\":\"0\"}"
}
```

### 3.7 高荷页订单（payment_continue_click - highly_video）
```json
{
  "event": "payment_continue_click",
  "extra": "{\"country\":\"USA\",\"entry_source\":\"highly_video\",\"app_version\":\"web\",\"selected_method\":\"{\\\"payChannel\\\":\\\"Credit_Card#AG\\\",\\\"title\\\":\\\"Credit Card\\\",\\\"iconUrl\\\":\\\"https://agilecdn.livchat.me/20231204/1701658321454.jpeg?Expires=1766803905&OSSAccessKeyId=LTAI5tNPNT6g1inCHkxgcUGz&Signature=B4543%2BphPfw%2B2ARK0L1p5ycfFMw%3D&x-oss-process=image%2Fresize%2Cm_lfit%2Ch_1080%2Cw_1080%2Climit_1\\\",\\\"presentCoinRatio\\\":50,\\\"promotionPresentCoinRatio\\\":10,\\\"jumpType\\\":0,\\\"itemType\\\":1,\\\"recommendReason\\\":\\\"Recommend\\\"}\",\"user_id\":\"2000539754441080832\",\"total_amount\":\"4.99\",\"entry_pv\":\"task\",\"user_tier\":\"guest\",\"device_type\":\"ios\",\"selected_package\":\"{\\\"id\\\":\\\"3f410d18-1d87-4cfa-bfe2-5a915d92aa20\\\",\\\"code\\\":\\\"522421\\\",\\\"price\\\":4.99,\\\"coins\\\":1200}\",\"previous_balance\":\"0\"}"
}
```

### 3.8 首日付费（payment_success）
```json
{
  "event": "payment_success",
  "extra": "{\"transaction_id\":\"31d1c4426c6f403cbd61e81428c1fead\",\"usd_amount\":\"9.99\",\"entry_source\":\"user_center\"}"
}
```

### 3.9 第三方绑定成功（user_bind）
```json
{
  "event": "user_bind",
  "extra": "{\"bind_method\":\"google\"}"
}
```

## 四、报表需求

### 统计指标

| 指标 | 说明 |
|-----|------|
| ~~广告曝光数~~ | ~~手动填写~~（已废弃） |
| ~~广告点击数~~ | ~~手动填写~~（已废弃） |
| 落地页曝光数 | 带有效 fbclid 的独立设备数（按 device_id 去重的 UV） |
| ~~落地页按钮点击数~~ | ~~点击落地页CTA按钮的独立设备数（按 device_id 去重的 UV）~~（已废弃） |
| 安全弹窗同意数 | 点击同意安全弹窗的新用户数（UV） |
| 高荷视频展示数 | 触发高荷视频的新用户数（UV） |
| 高荷触发付费数 | 点击充值按钮的新用户数（UV） |
| 促销弹窗订单数 | 从促销弹窗入口创建订单的新用户数（UV） |
| 高荷页订单数 | 从高荷页入口（`entry_source == "highly_video"`）创建订单的新用户数（UV） |
| 首日付费数 | 当日所有完成支付的新用户数（UV），不限入口来源 |
| 第三方绑定成功数 | 完成第三方账号绑定的新用户数（UV） |
| 促销付费率 | 首日付费数 / 安全弹窗同意数 × 100% |

### 报表示例

| 日期 | ~~广告曝光数~~ | ~~广告点击数~~ | 落地页曝光数 | ~~落地页按钮点击数~~ | 安全弹窗同意数 | 高荷视频展示数 | 高荷触发付费数 | 促销弹窗订单数 | 高荷页订单数 | 首日付费数 | 第三方绑定成功数 | 促销付费率 |
|------|-----------|-----------|-------------|----------------|--------------|--------------|--------------|--------------|------------|----------|----------------|----------|
| 2025-12-10 | ~~100,000~~ | ~~5,000~~ | 4,500 | ~~4,000~~ | 3,000 | 2,000 | 500 | 400 | 350 | 300 | 1,500 | 10.0% |
